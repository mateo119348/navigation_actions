{
  "operation_type":"AUTHORIZATION",
  "validations": [
    {
      "type":"greater_than",
      "field":"amount",
      "value_type":"decimal",
      "value":0
    },
    {
      "type":"less_equal_than",
      "field":"is_reservation",
      "value_type":"deciaml",
      "value":50000
    }
  ],

  "steps":[
    {
      "id":"set_amount",
      "required_fields":[
        "amount"
      ],
      "optional_fields":[
        "cart",
        "description"
      ],
      "rule":null
    },
    {
      "id":"set_buyer_email",
      "required_fields":[
        "buyer_email"
      ],
      "optional_fields":null,
      "rule":{
        "type":"equals",
        "field":"is_reservation",
        "value_type":"bool",
        "value":true
      }
    },
    {
      "id":"set_card_type",
      "required_fields":[
        "card_type"
      ],
      "optional_fields":[
        "installments"
      ],
      "rule":null
    },
    {
      "id":"set_installments",
      "required_fields":[
        "installments"
      ],
      "optional_fields":null,
      "rule":null
    },
    {
      "id":"set_device",
      "required_fields":[
        "device"
      ],
      "optional_fields":null,
      "rule":null
    },
    {
      "id":"read_card",
      "required_fields":[
        "card_data"
      ],
      "optional_fields":null,
      "rule":null
    },
    {
      "id":"tokenize_card",
      "required_fields":[
        "card_token",
        "payment_method"
      ],
      "optional_fields":null,
      "rule":null
    },
    {
      "id":"set_cvv",
      "required_fields":[
        "cvv"
      ],
      "optional_fields":null,
      "rule":{
        "type":"and",
        "rules": [
          {
            "type":"equals",
            "field":"pin_type",
            "value_type":"string",
            "value":"none"
          },
          {
            "type":"equals",
            "field":"on_site_allowed",
            "value_type":"bool",
            "value":true
          }
        ]
      }
    },
    {
      "id":"post_payment",
      "required_fields":[
        "payment"
      ],
      "optional_fields":null,
      "rule":null
    },
    {
      "id":"emv_finish_transaction",
      "required_fields":[
        "sent_advice",
        "was_reversed"
      ],
      "optional_fields":null,
      "rule":{
        "type":"and",
        "rules":[
          {
            "type":"equals",
            "field":"card_data_entry_mode",
            "value_type":"string",
            "value":"chip"
          },
          {
            "type":"equals",
            "field":"on_site_allowed",
            "value_type":"bool",
            "value":false
          }
        ]
      }
    },
    {
      "id":"sign",
      "required_fields":[
        "signature"
      ],
      "optional_fields":null,
      "rule":{
        "type":"and",
        "rules":[
          {
            "type":"equals",
            "field":"signature_required",
            "value_type":"bool",
            "value":true
          },
          {
            "type":"equals",
            "field":"payment_status",
            "value_type":"string",
            "value":"approved"
          }
        ]
      }
    },
    {
      "id":"post_notification",
      "required_fields":[
        "notification"
      ],
      "optional_fields":null,
      "rule":null
    },
    {
      "id":"congrats",
      "required_fields":[
        "showed_payment_result"
      ],
      "optional_fields":null,
      "rule":{
        "type":"equals",
        "field_id":"payment_status",
        "type":"string",
        "value":"approved"
      }
    },
    {
      "id":"payment_failed",
      "required_fields":[
        "showed_payment_result"
      ],
      "optional_fields":null,
      "rule":{
        "type":"distinct",
        "field_id":"payment_status",
        "type":"string",
        "value":"approved"
      }
    }
  ]
}